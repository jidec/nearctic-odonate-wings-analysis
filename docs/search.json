[
  {
    "objectID": "descriptive.html",
    "href": "descriptive.html",
    "title": "Descriptive",
    "section": "",
    "text": "Load packages for exploratory data visualization, and prep data\n\nlibrary(DataExplorer)\nlibrary(GGally)\nlibrary(colorEvoHelpers)\nlibrary(dplyr)\n\nwings &lt;- read.csv(\"data/wings.csv\")\n\nwings$blackbrown &lt;- wings$black\nwings$brownyellow &lt;- wings$brown\nwings$sex &lt;- wings$Sex\nwings$wing_length &lt;- wings$Length..outer..FW..mm.\nwings$temperature &lt;- wings$temp_indv\nwings$flight_type &lt;- wings$flight_type_rm_inter\nwings$is_damselfly &lt;- wings$Suborder == \"Zygoptera\"\n\nWhat colors have come out of our clustering?\n\nrow &lt;- wings[1,]\n\nplotRGB(c(row$col_1_r,row$col_1_g,row$col_1_b),max=1)\n\n\n\nplotRGB(c(row$col_2_r,row$col_2_g,row$col_2_b),max=1)\n\n\n\nplotRGB(c(row$col_3_r,row$col_3_g,row$col_3_b),max=1)\n\n\n\n\nVisualize the distribution of the Odonate percher-flyer dichotomy (flight_type) and sex in the dataset\n\nplot_bar(select(wings, flight_type, sex))\n\n\n\n\n\nMany more perchers than flyers\nMore males than females\n\nVisualize distributions of continuous predictors and responses\n\nplot_density(select(wings,blackbrown,brownyellow,temp_indv,wing_length)) #temp_indv,lat,lon,mean_lightness))\n\n\n\n\nMany zeroes in black-brown and brown-yellow, while wing length is close to a normal distribution\nVisualize correlations between pertinent variables\n\nplot_correlation(select(wings,blackbrown,brownyellow,temp_indv,Length..inner..FW..mm.,flight_type, Sex))\n\nWarning: Removed 30 rows containing missing values (`geom_text()`).\n\n\n\n\n\nWhat collections are specimens from?\n\nlibrary(dplyr)\nsupp &lt;- wings %&gt;%\n  select(Collection,Collection.Unique.ID) %&gt;%\n  distinct(Collection.Unique.ID, .keep_all = TRUE)\n\nView(supp)\n\ntable(supp$Collection)\n\n\n   MLM    RUN    RWG     UA    WRK WRK-WS \n   762    533     31   1942     27    789 \n\nsupp$Col &lt;- supp$Collection\n\nsupp$Col[supp$Collection == \"UA\"] &lt;- \"Alabama Museum of Natural History\"\nsupp$Col[supp$Collection == \"MLM\"] &lt;- \"Collection of Michael L. May\"\nsupp$Col[supp$Collection == \"RUN\"] &lt;- \"Rutgers-University Newark (Now Housed at AMNH)\"\nsupp$Col[supp$Collection == \"WRK-WS\"] &lt;- \"Collection of William Kuhn (Now Housed at AMNH)\"\n\ncolnames(supp) &lt;- c(\"collection_code\",\"collection_unique_id\", \"collection_name\")"
  },
  {
    "objectID": "supplemental.html",
    "href": "supplemental.html",
    "title": "Supplemental",
    "section": "",
    "text": "Create supplemental information tables and figures.\nLoad packages and read in the saved models.\n\nlibrary(tidyverse)\n\nWarning: package 'tidyverse' was built under R version 4.2.1\n\n\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.4.0     ✔ purrr   1.0.1\n✔ tibble  3.2.1     ✔ dplyr   1.1.4\n✔ tidyr   1.3.0     ✔ stringr 1.5.0\n✔ readr   2.1.2     ✔ forcats 0.5.2\n\n\nWarning: package 'ggplot2' was built under R version 4.2.2\n\n\nWarning: package 'tibble' was built under R version 4.2.3\n\n\nWarning: package 'tidyr' was built under R version 4.2.2\n\n\nWarning: package 'readr' was built under R version 4.2.1\n\n\nWarning: package 'purrr' was built under R version 4.2.2\n\n\nWarning: package 'dplyr' was built under R version 4.2.3\n\n\nWarning: package 'stringr' was built under R version 4.2.2\n\n\nWarning: package 'forcats' was built under R version 4.2.1\n\n\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n\nlibrary(brms)\n\nWarning: package 'brms' was built under R version 4.2.3\n\n\nLoading required package: Rcpp\n\n\nWarning: package 'Rcpp' was built under R version 4.2.3\n\n\nLoading 'brms' package (version 2.21.0). Useful instructions\ncan be found by typing help('brms'). A more detailed introduction\nto the package is available through vignette('brms_overview').\n\nAttaching package: 'brms'\n\nThe following object is masked from 'package:stats':\n\n    ar\n\nlibrary(ggpubr)\n\nWarning: package 'ggpubr' was built under R version 4.2.3\n\nlibrary(gt)\n\nWarning: package 'gt' was built under R version 4.2.3\n\nbb_m &lt;- readRDS(\"data/blackBrown_phylo_m1_nestedRI_spatialTerm.rds\")\nby_m &lt;- readRDS(\"data/brownYellow_phylo_m1_nestedRI_spatialTerm.rds\")\n\nCreate model summary tables.\n\nbb_summary &lt;- summary(bb_m, prob = 0.95)$fixed %&gt;% \n  tibble::rownames_to_column()\nby_summary &lt;- summary(by_m, prob = 0.95)$fixed %&gt;% \n  tibble::rownames_to_column()\n\nWarning: There were 1 divergent transitions after warmup. Increasing\nadapt_delta above 0.99 may help. See\nhttp://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup\n\nbb_table &lt;- gt(bb_summary)\nby_table &lt;- gt(by_summary) \n\nbb_table\n\n\n\n\n\n  \n    \n      \n      Estimate\n      Est.Error\n      l-95% CI\n      u-95% CI\n      Rhat\n      Bulk_ESS\n      Tail_ESS\n    \n  \n  \n    Intercept\n-4.5276651315\n1.10928675\n-6.66226225\n-2.3178460000\n1.0006397\n2115.302\n3242.603\n    phi_Intercept\n6.0830381025\n0.16486777\n5.75841025\n6.4140777500\n1.0038106\n1294.990\n2430.175\n    zi_Intercept\n2.7071448433\n0.71236662\n1.29290275\n4.0606865000\n1.0021717\n1320.824\n1968.450\n    wing_length\n0.2162540673\n0.05464696\n0.11214380\n0.3256864000\n1.0003217\n5283.045\n5098.930\n    temp_indv\n0.0987507107\n0.06964641\n-0.04429018\n0.2344792250\n1.0019513\n4228.509\n5204.969\n    flight_typepercher\n1.1159524019\n0.57493738\n-0.01822978\n2.2189372500\n1.0003200\n3082.211\n4670.462\n    sexM\n-0.1211839210\n0.05790818\n-0.22797303\n-0.0002941049\n0.9998385\n5503.419\n5178.731\n    temp_indv:flight_typepercher\n0.0258943923\n0.05962403\n-0.08648277\n0.1511635000\n1.0016008\n4740.096\n5384.486\n    flight_typepercher:sexM\n0.1733500388\n0.06160333\n0.04843533\n0.2898606500\n0.9996731\n6024.413\n5426.507\n    phi_temp_indv\n-0.3322417266\n0.07123384\n-0.47360107\n-0.1958198250\n1.0012592\n4637.632\n5842.396\n    zi_wing_length\n-1.5268252261\n0.22061660\n-1.97057350\n-1.0910855000\n1.0007466\n2406.234\n3399.187\n    zi_temp_indv\n0.6003061364\n0.08974760\n0.42425603\n0.7753026500\n1.0000832\n5020.524\n5120.373\n    zi_flight_typepercher\n-0.4463208730\n0.76793695\n-1.91479875\n1.1059605000\n1.0006828\n1069.864\n2129.942\n    zi_sexM\n-1.0250841575\n0.10822225\n-1.24250275\n-0.8182290000\n1.0006139\n8499.190\n5986.850\n    t2latRoundlonRound_1\n-0.0007196809\n0.03642289\n-0.07521080\n0.0683186875\n1.0011127\n4270.392\n5035.483\n    t2latRoundlonRound_2\n-0.1438599316\n0.06217080\n-0.27109870\n-0.0269602675\n1.0004217\n4819.822\n5708.773\n    t2latRoundlonRound_3\n0.0045874120\n0.03784004\n-0.06991745\n0.0805199650\n1.0007402\n4551.943\n4997.438\n  \n  \n  \n\n\n\nby_table\n\n\n\n\n\n  \n    \n      \n      Estimate\n      Est.Error\n      l-95% CI\n      u-95% CI\n      Rhat\n      Bulk_ESS\n      Tail_ESS\n    \n  \n  \n    Intercept\n-3.148101774\n0.88990676\n-4.88665875\n-1.37509225\n1.0004733\n2521.4854\n3665.013\n    phi_Intercept\n4.984058688\n0.16230907\n4.66051525\n5.30849300\n1.0063449\n582.0368\n1080.530\n    zi_Intercept\n-3.740895639\n0.69906008\n-5.19817625\n-2.46850625\n1.0002328\n4257.6413\n5585.685\n    wing_length\n0.212359888\n0.04181256\n0.13036703\n0.29367887\n1.0012927\n9967.3609\n6691.654\n    temp_indv\n0.083093121\n0.06728538\n-0.04573421\n0.21540752\n1.0012183\n4299.5858\n5441.740\n    flight_typepercher\n0.737579316\n0.51139342\n-0.27878295\n1.72560250\n1.0005874\n3820.7683\n4896.712\n    sexM\n-0.067404117\n0.05141467\n-0.16718242\n0.03437644\n1.0002653\n6326.7601\n6146.343\n    temp_indv:flight_typepercher\n0.003562942\n0.05776505\n-0.10810462\n0.11547682\n1.0008937\n5571.7530\n5641.405\n    flight_typepercher:sexM\n0.012555641\n0.05279774\n-0.09095624\n0.11702230\n1.0002519\n6462.6708\n6195.905\n    phi_temp_indv\n-0.267775750\n0.04767827\n-0.36355532\n-0.17440980\n1.0002034\n4711.8713\n5471.847\n    zi_wing_length\n-1.187550026\n0.20122209\n-1.59814300\n-0.79997398\n1.0004926\n2819.5424\n4788.065\n    zi_temp_indv\n0.117605183\n0.11370667\n-0.10383457\n0.34328627\n1.0003119\n7743.9811\n6502.946\n    zi_flight_typepercher\n-0.030432418\n0.71876755\n-1.38123850\n1.42911225\n1.0008620\n4268.4197\n5657.992\n    zi_sexM\n-0.904499112\n0.14237704\n-1.18420500\n-0.62359690\n1.0009826\n13316.8416\n5913.259\n    t2latlon_1\n-0.018461812\n0.03104168\n-0.07757623\n0.04473045\n1.0003608\n4968.7799\n4659.282\n    t2latlon_2\n-0.069496123\n0.04963546\n-0.16559347\n0.03422042\n1.0005858\n5810.4665\n6165.698\n    t2latlon_3\n-0.031710607\n0.03498716\n-0.09465432\n0.04296342\n0.9999612\n4143.6705\n4025.747\n  \n  \n  \n\n\n\ngtsave(bb_table, filename = \"figures/bb_table.html\")\ngtsave(by_table, filename = \"figures/by_table.html\")\n\nPlot model diagnostics (density overlay posterior predictive checks).\n\nbb_pp &lt;- pp_check(bb_m, ndraws = 100) + theme_classic()\nbb_pp_part1 &lt;- bb_pp + xlim(0,0.025) + ylim(0,750)\nbb_pp_part2 &lt;- bb_pp + xlim(0.025,1) + ylim(0,10)\nbb_pp\n\n\n\nbb_pp_part1\n\nWarning: Removed 71406 rows containing non-finite values (`stat_density()`).\n\n\nWarning: Removed 672 rows containing non-finite values (`stat_density()`).\n\n\nWarning: Removed 124 rows containing missing values (`geom_line()`).\n\n\n\n\nbb_pp_part2\n\nWarning: Removed 398394 rows containing non-finite values (`stat_density()`).\n\n\nWarning: Removed 4025 rows containing non-finite values (`stat_density()`).\n\n\n\n\nby_pp &lt;- pp_check(by_m, ndraws = 100) + theme_classic()\nby_pp_part1 &lt;- by_pp + xlim(0,0.03) + ylim(0,750)\nby_pp_part2 &lt;- by_pp + xlim(0.03,1) + ylim(0,10)\nby_pp\n\n\n\nby_pp_part1\n\nWarning: Removed 196365 rows containing non-finite values (`stat_density()`).\n\n\nWarning: Removed 1875 rows containing non-finite values (`stat_density()`).\n\n\n\n\nby_pp_part2\n\nWarning: Removed 273435 rows containing non-finite values (`stat_density()`).\n\n\nWarning: Removed 2823 rows containing non-finite values (`stat_density()`)."
  },
  {
    "objectID": "publication_figures.html",
    "href": "publication_figures.html",
    "title": "Publication Figures",
    "section": "",
    "text": "Below are the steps to build Fig. 3 and 4 shown in our publication (Fig. 1 was done by a coauthor using a separate pipeline and Fig. 2 which was done by hand incorporating scatter plots from Python).\nlibrary(brms)\n\nWarning: package 'brms' was built under R version 4.2.3\n\n\nLoading required package: Rcpp\n\n\nWarning: package 'Rcpp' was built under R version 4.2.3\n\n\nLoading 'brms' package (version 2.21.0). Useful instructions\ncan be found by typing help('brms'). A more detailed introduction\nto the package is available through vignette('brms_overview').\n\n\n\nAttaching package: 'brms'\n\n\nThe following object is masked from 'package:stats':\n\n    ar\n\nlibrary(ggplot2)\n\nWarning: package 'ggplot2' was built under R version 4.2.2\n\nlibrary(ggpubr)\n\nWarning: package 'ggpubr' was built under R version 4.2.3\n\n# read saved brms models\nbb &lt;- readRDS(\"data/blackBrown_phylo_m1_nestedRI_spatialTerm.rds\")\nby &lt;- readRDS(\"data/brownyellow_phylo_m1_nestedRI_spatialTerm.rds\")\n\n# helper to convert a brms effects model to a ggplot model \nbrms2ggplot &lt;- function(cond_effects){\n  return(plot(cond_effects,plot=FALSE)[[1]])\n}"
  },
  {
    "objectID": "publication_figures.html#figure-3.-wing-length-flight-style-and-temperature-influence-the-amount-or-presence-of-black-dark-brown-wing-color",
    "href": "publication_figures.html#figure-3.-wing-length-flight-style-and-temperature-influence-the-amount-or-presence-of-black-dark-brown-wing-color",
    "title": "Publication Figures",
    "section": "Figure 3. Wing length, flight style, and temperature influence the amount or presence of black-dark brown wing color",
    "text": "Figure 3. Wing length, flight style, and temperature influence the amount or presence of black-dark brown wing color\n\nwing_length_more_bb &lt;- brms2ggplot(conditional_effects(bb, effects = \"wing_length\")) + labs(x = \"Wing Length\", y = \"Black-brown Amount\")\n\nmale_perchers_more_bb &lt;- brms2ggplot(conditional_effects(bb, effects = \"flight_type:sex\")) + labs(x = \"Flight Type\", y = \"\") \n                     \nplot &lt;- conditional_effects(bb, effects = \"wing_length\", dpar = \"zi\")\nplot$wing_length$estimate__ &lt;- 1 - plot$wing_length$estimate__\nplot$wing_length$lower__ &lt;- 1 - plot$wing_length$lower__\nplot$wing_length$upper__ &lt;- 1 - plot$wing_length$upper__\nwing_length_less_bb_zeros &lt;- brms2ggplot(plot) + labs(x = \"Wing Length\", y = \"Odds of Black-brown Presence\") \n\nplot &lt;- conditional_effects(bb, effects = \"temp_indv\", dpar = \"zi\")\nplot$temp_indv$estimate__ &lt;- 1 - plot$temp_indv$estimate__\nplot$temp_indv$lower__ &lt;- 1 - plot$temp_indv$lower__\nplot$temp_indv$upper__ &lt;- 1 - plot$temp_indv$upper__\ntemp_less_bb_zeros &lt;- brms2ggplot(plot) + labs(x = \"Temperature\", y = \"\")\n\n\nggarrange(wing_length_more_bb,male_perchers_more_bb,wing_length_less_bb_zeros,temp_less_bb_zeros, ncol = 2, nrow = 2)"
  },
  {
    "objectID": "publication_figures.html#figure-4.-wing-length-and-sex-influence-the-amount-or-presence-of-light-brown-yellow-wing-color",
    "href": "publication_figures.html#figure-4.-wing-length-and-sex-influence-the-amount-or-presence-of-light-brown-yellow-wing-color",
    "title": "Publication Figures",
    "section": "Figure 4. Wing length and sex influence the amount or presence of light-brown yellow wing color",
    "text": "Figure 4. Wing length and sex influence the amount or presence of light-brown yellow wing color\n\nwing_length_more_by &lt;- brms2ggplot(conditional_effects(by, effects = \"wing_length\")) + labs(x = \"Wing Length\", y = \"Brown-yellow Proportion\")\nmales_less_by_zeros &lt;-  brms2ggplot(conditional_effects(by, effects = \"sex\", dpar = \"zi\")) + labs(x = \"Sex\", y = \"Odds of Brown-yellow Absence\") + theme(axis.title.y = element_text(size = 8))\n\nplot &lt;- conditional_effects(by, effects = \"sex\", dpar = \"zi\")\nplot$sex$estimate__ &lt;- 1 - plot$sex$estimate__\nplot$sex$lower__ &lt;- 1 - plot$sex$lower__\nplot$sex$upper__ &lt;- 1 - plot$sex$upper__\nsex_presence &lt;- brms2ggplot(plot) + labs(x = \"Sex\", y = \"Odds of Brown-yellow Presence\")\n\nplot &lt;- conditional_effects(by, effects = \"wing_length\", dpar = \"zi\")\nplot$wing_length$estimate__ &lt;- 1 - plot$wing_length$estimate__\nplot$wing_length$lower__ &lt;- 1 - plot$wing_length$lower__\nplot$wing_length$upper__ &lt;- 1 - plot$wing_length$upper__\nwing_length_more_by_presence &lt;- brms2ggplot(plot) + labs(x = \"Wing Length\", y = \"Odds of Brown-yellow Presence\")\n\nggarrange(wing_length_more_by,sex_presence,wing_length_more_by_presence,nrow=3,ncol=1)"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "About",
    "section": "",
    "text": "This is a “papers with code” website for “Interactions between sexual signaling and wing size drive ecology and evolution of wing colors in Odonata” published in Scientific Reports.\nThis is my first “papers with code” website and I expect to improve upon this format in the future.\nPaper by Jacob Idec, Seth Bybee, Jessica Ware, John Abbott, Rhainer Guillermo Ferreira, Anton Suvorov, Manpreet Kohli, Louis Eppel, William R Kuhn, Michael Belitz, and Robert Guralnick."
  },
  {
    "objectID": "index.html#intro",
    "href": "index.html#intro",
    "title": "About",
    "section": "Intro",
    "text": "Intro\nInsect coloration has evolved in response to multiple pressures, and in Odonata (dragonflies and damselflies) a body of work supports a role of wing color in a variety of visual signals and potentially in thermoregulation. Previous efforts have focused primarily on melanistic coloration even though wings are often multicolored, and there has yet to be comprehensive comparative analyses of wing color across broad geographic regions and phylogenetic groups. Percher vs. flier flight-style, a trait with thermoregulatory and signaling consequences, has not yet been studied with regard to color. The ODOMATIC wing dataset containing 8000 wings imaged by flatbed scanner provides a means to address these questions."
  },
  {
    "objectID": "index.html#questions",
    "href": "index.html#questions",
    "title": "About",
    "section": "Questions",
    "text": "Questions\n\nWhat kinds of wing colors are present across Odonates, and do they serve different functions?\nIs dark wing color a territorial signal?\nIs wing size related to color, and if so why?"
  },
  {
    "objectID": "index.html#predictions-based-on-previous-research",
    "href": "index.html#predictions-based-on-previous-research",
    "title": "About",
    "section": "Predictions based on previous research",
    "text": "Predictions based on previous research\n\nDark wing color will be enhanced in percher males for territorial signaling"
  },
  {
    "objectID": "data_prep.html",
    "href": "data_prep.html",
    "title": "Data Prep",
    "section": "",
    "text": "Note - performing the second clustering step as I did requires Python with the package bigcrittercolor, so if you don’t want to do this I would recommend skipping to the “Descriptive” page where we load the data after clustering has been performed.\nManually download wing segments from Zenodo (https://zenodo.org/records/10714418). The below code assumes segments are placed in the data/segments folder, but of course you can place them anywhere as long as you provide that path.\nLoad colorEvoHelpers (a personal package) installing it if necessary.\n\n#devtools::install_github(\"jidec/color-evo-helpers\")\nlibrary(colorEvoHelpers)\nlibrary(dplyr)\nlibrary(recolorize)\n\nPerform first clustering step, which applies clustering from the R package recolorize to all images individually.\n\n# median_blur_n is the pixel size of the blur kernel\n# cluster_cutoff is the cutoff for the recolorize function, determining what clusters to keep \nrecolorizeSegmentDir(dir=\"data/segments\",\"data/bcc_project/patterns\",median_blur_n = 7, cluster_cutoff = 25) \n\nThe Python clustering function is part of the package bigcrittercolor.\nIn Python, look at dispersion and cohesion scores to pick a number of clusters.\n\n#!pip install git+https://github.com/jidec/bigcrittercolor.git@main\nfrom bigcrittercolor import clusterColorsToPatterns\nfrom bigcrittercolor.helpers.ids import _getIDsInFolder\n\nids = _getIDsInFolder(\"data/segments\")\nids = [i + \"_hind\" for i in ids] + [i + \"_fore\" for i in ids]\n\nclusterColorsToPatterns(img_ids=ids, preclustered=True, blur_args={'type':\"gaussian\",'ksize':21}, equalize_args=None,\n                        colorspace=\"rgb\",\n                        cluster_args={'algo':\"gaussian_mixture\"},\n                        data_folder=\"data/bcc_project/patterns\",height_resize=20)\n\nPerform second clustering step.\n\nids = _getIDsInFolder(\"D:/wing-color/data/segments\")\nids = [i + \"_hind\" for i in ids] + [i + \"_fore\" for i in ids]\n\nclusterColorsToPatterns(img_ids=ids, preclustered=True, blur_args={'type':\"gaussian\",'ksize':21}, equalize_args=None,\n                        colorspace=\"rgb\",\n                        cluster_args={'algo':\"gaussian_mixture\",'n':3},\n                        data_folder=\"data/bcc_project/patterns\",height_resize=20)\n\nPrep the wing data, returning a tuple containing:\n1. individual-level data\n2. individual-level data trimmed to phy\n3. phy trimmed to data\n4. species-level data\n5. species-level data trimmed to phy\n6. species-sex level data\n7. species-sex-forehind level data\n\nsource(\"R/prepOdomaticDataFromPatterns.R\")\ndata &lt;- prepOdomaticDataFromPatterns(wing_img_loc = \"data/patterns/grouped2\", tc1_1 = 0.5529, tc1_2 = 0.2470)\n\nNote to self - do this more simply next time!"
  },
  {
    "objectID": "modeling.html",
    "href": "modeling.html",
    "title": "Modeling",
    "section": "",
    "text": "Create Bayesian model predicting presence and amount of black-dark brown using wing length, local temperature, flight style, sex, and wing type (hind or fore)\n\nlibrary(tidyverse)\nlibrary(brms)\nlibrary(ncf)\n\nmdf &lt;- read.csv(\"data/wings_for_mike.csv\")\nmdf &lt;- na.omit(mdf)\nmdf &lt;- mdf %&gt;% \n  mutate(wing_length = scale(wing_length),\n         temp_indv = scale(temp_indv))\n##make more complicated\nmdf &lt;- mdf %&gt;% \n  mutate(is_damselfly = if_else(is_damselfly, 1, 0))\nmdf$is_damselfly &lt;- as.factor(mdf$is_damselfly)\n\n\n# phylogenetic signal\nlibrary(ape)\node_tree &lt;- read.tree(file = \"data/odonata.tre\")\n\nmdf &lt;- mdf %&gt;% \n  mutate(spp = stringr::str_replace(species, \" \", \"_\"))\n\ntoDelete &lt;- data.frame(tree_spp = ode_tree$tip.label) %&gt;% \n  filter(!tree_spp %in% mdf$spp)\n\node_tree_cut &lt;- drop.tip(ode_tree, tip = toDelete$tree_spp)\n\nmdf_phylo &lt;- mdf %&gt;% \n  filter(spp %in% ode_tree_cut$tip.label)\n\nmdf_phylo &lt;- mdf_phylo %&gt;% \n  mutate(latRound = round(lat,2),\n         lonRound = round(lon,2))\n\n\n# add phylogenetic term\nA &lt;- ape::vcv.phylo(ode_tree_cut)\n\n# Create the model formula\nri_formula &lt;- bf(\n  # mu (mean) part\n  blackbrown ~ wing_length + temp_indv + flight_type + \n    sex + temp_indv:flight_type + sex:flight_type + t2(latRound, lonRound) +\n    (1|species/wing_type) + (1|gr(spp, cov = A)),\n  # phi (precision) part\n  phi ~ temp_indv + (1 | species/wing_type),\n  # alpha (zero-inflation) part\n  zi ~ wing_length + temp_indv + flight_type + sex + (1 | species/wing_type)\n)\n\n# specify priors\nget_prior(\n  ri_formula,\n  data = mdf_phylo,\n  data2 = list(A = A),\n  family = zero_inflated_beta()\n)\n\npriors &lt;- c(set_prior(\"student_t(3, 0, 2)\", class = \"Intercept\"),\n            set_prior(\"normal(0.5, 1)\", class = \"b\"))\n\n\nri_model_phy &lt;- brm(\n  ri_formula,\n  data = mdf_phylo,\n  data2 = list(A = A),\n  family = zero_inflated_beta(),\n  prior = priors,\n  init = \"0\",\n  chains = 4, iter = 3000, warmup = 1000,\n  cores = 16, seed = 1234, \n  threads = threading(2),\n  backend = \"cmdstanr\", \n  control = list(adapt_delta = 0.99,\n                 max_treedepth = 16),\n)\n\nsummary(ri_model_phy)\nsaveRDS(object = ri_model_phy, file = \"data/blackBrown_phylo_m1_nestedRI_spatialTerm.rds\")\n\nr &lt;- residuals(ri_model_phy)\n\nndf_df &lt;- data.frame(lon = mdf_phylo$lon, lat = mdf_phylo$lat, z = r[,1])\n\nfit_cor &lt;- correlog(x = ndf_df$lon, y = ndf_df$lat, z = ndf_df$z, increment = 1, resamp = 100)\nplot(fit_cor)\n\nCreate model for light-brown yellow\n\nlibrary(tidyverse)\nlibrary(brms)\nlibrary(ncf)\n\nmdf &lt;- read.csv(\"data/wings_for_mike.csv\")\nmdf &lt;- na.omit(mdf)\nmdf &lt;- mdf %&gt;% \n  mutate(wing_length = scale(wing_length),\n         temp_indv = scale(temp_indv))\n##make more complicated\nmdf &lt;- mdf %&gt;% \n  mutate(is_damselfly = if_else(is_damselfly, 1, 0))\nmdf$is_damselfly &lt;- as.factor(mdf$is_damselfly)\n\n\n# phylogenetic signal\nlibrary(ape)\node_tree &lt;- read.tree(file = \"data/odonata.tre\")\n\nmdf &lt;- mdf %&gt;% \n  mutate(spp = stringr::str_replace(species, \" \", \"_\"))\n\ntoDelete &lt;- data.frame(tree_spp = ode_tree$tip.label) %&gt;% \n  filter(!tree_spp %in% mdf$spp)\n\node_tree_cut &lt;- drop.tip(ode_tree, tip = toDelete$tree_spp)\n\nmdf_phylo &lt;- mdf %&gt;% \n  filter(spp %in% ode_tree_cut$tip.label)\n\nmdf_phylo &lt;- mdf_phylo %&gt;% \n  mutate(latRound = round(lat,2),\n         lonRound = round(lon,2))\n\n\n# add phylogenetic term\nA &lt;- ape::vcv.phylo(ode_tree_cut)\n\n# Create the model formula\nri_formula &lt;- bf(\n  # mu (mean) part\n  brownyellow ~ wing_length + temp_indv + flight_type + \n    sex + temp_indv:flight_type + sex:flight_type + t2(latRound, lonRound) +\n    (1|species/wing_type) + (1|gr(spp, cov = A)),\n  # phi (precision) part\n  phi ~ temp_indv + (1 | species/wing_type),\n  # alpha (zero-inflation) part\n  zi ~ wing_length + temp_indv + flight_type + sex + (1 | species/wing_type)\n)\n\n# specify priors\nget_prior(\n  ri_formula,\n  data = mdf_phylo,\n  data2 = list(A = A),\n  family = zero_inflated_beta()\n)\n\npriors &lt;- c(set_prior(\"student_t(3, 0, 2)\", class = \"Intercept\"),\n            set_prior(\"normal(0.5, 1)\", class = \"b\"))\n\n\nri_model_phy &lt;- brm(\n  ri_formula,\n  data = mdf_phylo,\n  data2 = list(A = A),\n  family = zero_inflated_beta(),\n  prior = priors,\n  init = \"0\",\n  chains = 4, iter = 3000, warmup = 1000,\n  cores = 16, seed = 1234, \n  threads = threading(2),\n  backend = \"cmdstanr\", \n  control = list(adapt_delta = 0.99,\n                 max_treedepth = 16),\n)\n\nsummary(ri_model_phy)\nsaveRDS(object = ri_model_phy, file = \"data/brownYellow_phylo_m1_nestedRI_spatialTerm.rds\")\n\nr &lt;- residuals(ri_model_phy)\n\nndf_df &lt;- data.frame(lon = mdf_phylo$lon, lat = mdf_phylo$lat, z = r[,1])\n\nfit_cor &lt;- correlog(x = ndf_df$lon, y = ndf_df$lat, z = ndf_df$z, increment = 1, resamp = 100)\nplot(fit_cor)"
  }
]